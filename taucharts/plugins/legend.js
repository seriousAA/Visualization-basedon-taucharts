/*!
 * /*
 * taucharts@2.7.2 (2019-04-22)
 * Copyright 2019 Targetprocess, Inc.
 * Licensed under Apache License 2.0
 * * /
 * 
 */
!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("taucharts"),require("d3-format"));else if("function"==typeof define&&define.amd)define(["taucharts","d3-format"],t);else{var r="object"==typeof exports?t(require("taucharts"),require("d3-format")):t(e.Taucharts,e.d3);for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,function(e,t){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=28)}({0:function(t,r){t.exports=e},28:function(e,t,r){"use strict";r.r(t);var n,a,i=r(0),o=r.n(i),c=r(9),l=o.a.api.utils,s=o.a.api.pluginsSDK,u=".tau-chart__legend__reset",d=".tau-chart__legend__item-color",h=".tau-chart__legend__guide--color__overlay",f=4,_=13,g=0,m=function(){return++g},p=o.a.api.utils.xml,v=function(e,t){var r=e[0],n=e[1],a=(n-r)/(t-1),i=l.range(t-2).map(function(e){return r+a*(e+1)});return[r].concat(i).concat(n)},b=function(e,t,r){if(e.length<3)return e.slice(0);if(t<3)return[e[0],e[e.length-1]];var n,a=e[0]<0?Math.abs(e[0]):0,i=function(e){return e},o="sqrt"===r?function(e){return Math.sqrt(e+a)}:i,c="sqrt"===r?function(e){return Math.pow(e,2)-a}:i,s=[(e=e.map(o))[0]],u=e[e.length-1]-e[0],d=.5*u/(t-1),h=l.range(1,t-1).map(function(e){var r=u*e/(t-1);return{min:r-d,mid:r,max:r+d,diff:Number.MAX_VALUE,closest:null}}),f=0,_=function(){if(f!==h.length){var e=n;(n=h[f++]).min=Math.max(n.min,(e&&null!==e.closest?e.closest:s[0])+d)}};return _(),e.forEach(function(e){if(!(e<n.min)){e>n.max&&_();var t=Math.abs(e-n.mid);t<n.diff&&t<d?(n.diff=t,n.closest=e):_(),0===t&&_()}}),h.forEach(function(e){null!==e.closest&&s.push(e.closest)}),s.push(e[e.length-1]),s=s.map(c)},y=function(e){return Math.log(e)/Math.LN10},x=function(e){return 0===e?0:Math.floor(y(Math.abs(e)))},S=(n=/\.0+([^\d].*)?$/,a=/(\.\d+?)0+([^\d].*)?$/,function(e){return e.replace(n,"$1").replace(a,"$1$2")}),w=c.format(".3s"),M=function(e){return S(w(e))},T=function(e,t){var r=Math.max(Math.abs(e),Math.abs(t)),n=x(r),a=e*t>0?Math.abs(t-e):r,i=x(a),o=Math.abs(n-i);return Math.abs(n)>3&&o<=3?M:function(e){var t=x(r-e),n=Math.min((i<0?Math.abs(i):0)+(t<i?1:0),20);return S(e.toFixed(n))}};function C(e){var t=!0,r=l.defaults(e||{},{formatters:{},onSelect:function(){}}),n=function(e){return null===e||""===e||void 0===e},a=function(e){return e.every(function(e){return l.isDate(e)})},i=function(e,t){return function(r){var a=r[e],i=JSON.stringify(n(a)?null:a);return t===i}},o=function(e,t,r,n){e.addEventListener(t,function(e){for(var t=e.target;t!==e.currentTarget&&null!==t;)t.matches(r)&&n(e,t),t=t.parentNode})};return{init:function(e){var t=this;this.instanceId=m(),this._chart=e,this._currentFilters={},this._legendColorByScaleId={},this._legendOrderState={};var n=this._chart.getSpec(),a=function(e){return function(t,r){var a=n.scales[r];return a.type===e&&a.dim&&t.push(r),t}};this._color=Object.keys(n.scales).reduce(a("color"),[]).filter(function(t){return e.getScaleInfo(t).discrete}),this._fill=Object.keys(n.scales).reduce(a("color"),[]).filter(function(t){return!e.getScaleInfo(t).discrete}),this._size=Object.keys(n.scales).reduce(a("size"),[]);var i=this._color.length>0,c=this._fill.length>0,l=this._size.length>0;if(this._assignStaticBrewersOrEx(),i||c||l){switch(r.position){case"left":this._container=this._chart.insertToLeftSidebar(this._containerTemplate);break;case"right":this._container=this._chart.insertToRightSidebar(this._containerTemplate);break;case"top":this._container=this._chart.insertToHeader(this._containerTemplate);break;case"bottom":this._container=this._chart.insertToFooter(this._containerTemplate);break;default:this._container=this._chart.insertToRightSidebar(this._containerTemplate)}i&&(o(this._container,"click",u,function(e,r){t._toggleLegendItem(r,"reset")}),o(this._container,"click",d,function(e,r){var n=e.ctrlKey||e.target.matches(h)?"leave-others":"focus-single";t._toggleLegendItem(r,n)}),o(this._container,"mouseover",d,function(e,r){t._highlightToggle(r,!0)}),o(this._container,"mouseout",d,function(e,r){t._highlightToggle(r,!1)}))}},destroy:function(){var e=this._currentFilters,t=this._chart;Object.keys(e).forEach(function(r){return t.removeFilter(e[r])}),this._container&&this._container.parentElement&&(this._clearPanel(),this._container.parentElement.removeChild(this._container))},onSpecReady:function(e,t){this._formatters=s.getFieldFormatters(t,r.formatters)},_getFormat:function(e){return this._formatters[e]?this._formatters[e].format:function(e){return String(e)}},onRender:function(){var e=this;if(t&&r.selectedCategories&&0!==r.selectedCategories.length){var n=this._getLegendColorByScales();return Object.keys(n).forEach(function(t){n[t].legendColorItems.forEach(function(t){var n=t.value,a=t.dim;if(-1===r.selectedCategories.indexOf(JSON.parse(n))){var o=a+n,c=i(a,n);e._currentFilters[o]=e._chart.addFilter({tag:"legend",predicate:function(e){return!c(e)}})}})}),t=!1,void this._chart.refresh()}this._clearPanel(),this._drawColorLegend(),this._drawFillLegend(),this._drawSizeLegend()},_containerTemplate:'<div class="tau-chart__legend"></div>',_template:l.template(['<div class="tau-chart__legend__wrap">',"<%=top%>",'<div class="tau-chart__legend__title"><%=name%></div>',"<%=items%>","</div>"].join("")),_itemTemplate:l.template(["<div data-scale-id='<%= scaleId %>' data-dim='<%= dim %>' data-value='<%= value %>' class=\"tau-chart__legend__item tau-chart__legend__item-color <%=classDisabled%>\">",'   <div class="tau-chart__legend__guide__wrap">','   <div class="tau-chart__legend__guide tau-chart__legend__guide--color <%=cssClass%>"','        style="background-color: <%=cssColor%>; border-color: <%=borderColor%>;">','       <div class="tau-chart__legend__guide--color__overlay">',"       </div>","   </div>","   </div>",'   <span class="tau-chart__legend__guide__label"><%=label%></span>',"</div>"].join("")),_resetTemplate:l.template(['<div class="tau-chart__legend__reset <%=classDisabled%>">','    <div role="button" class="tau-chart__button">Reset</div>',"</div>"].join("")),_clearPanel:function(){this._container&&(clearTimeout(this._scrollTimeout),this._getScrollContainer().removeEventListener("scroll",this._scrollListener),this._container.innerHTML="")},_drawFillLegend:function(){var e=this;e._fill.forEach(function(t){var r,n,i,o=e._chart.select(function(e){return e.config.color===t})[0];if(o){var c=o.config.guide||{},u=o.getScale("color"),d=u.domain().sort(function(e,t){return e-t}),h=a(d),f=h?d.map(Number):d,g=T(f[0],f[f.length-1]),m=function(){var t=e._chart.getSpec(),r=s.extractFieldsFormatInfo(t)[u.dim].format;return r||(r=function(e){return new Date(e)}),function(e){return String(r(e))}}(),b=h?m:g,y=u.brewer.length,x=((c.color||{}).label||{}).text||u.dim,S=function(e){return e.length*_*.618},w=u.isInteger?(f[1]-f[0])%3==0?4:(f[1]-f[0])%2==0?3:2:3,M=v(f,w),C=(h?M.map(function(e){return new Date(e)}):M).map(b);C[0]===C[C.length-1]&&(C=[C[0]]),e._container.insertAdjacentHTML("beforeend",e._template({name:l.escape(x),top:null,items:'<div class="tau-chart__legend__gradient-wrapper"></div>'}));var L=e._container.lastElementChild.querySelector(".tau-chart__legend__gradient-wrapper"),j=L.getBoundingClientRect().width,F=!1;C.reduce(function(e,t){return e+S(t)},0)>j&&(C.length>1&&S(C[0])+S(C[C.length-1])>j?F=!0:C=[C[0],C[C.length-1]]);var A=F?(i=-.382*_/2,{width:j,height:120,barX:0,barY:0,barWidth:20,barHeight:120,textAnchor:"start",textX:l.range(w).map(function(){return 25}),textY:1===C.length?60+.618*_:C.map(function(e,t){var r=(C.length-1-t)/(C.length-1);return _*(1-r)+120*r+i})}):(r=S(C[0])/2,n=S(C[C.length-1])/2,{width:j,height:28+_,barX:0,barY:0,barWidth:j,barHeight:20,textAnchor:"middle",textX:1===C.length?[j/2]:C.map(function(e,t){var a=t/(C.length-1);return r*(1-a)+(j-n)*a}),textY:l.range(w).map(function(){return 28+_})}),O=v(f,y).map(function(e,t){return p("stop",{offset:t/(y-1)*100+"%",style:"stop-color:"+u(e)+';stop-opacity:1"'})}),k="legend-gradient-"+e.instanceId,E=p.apply(void 0,["svg",{class:"tau-chart__legend__gradient",width:A.width,height:A.height},p("defs",p.apply(void 0,["linearGradient",{id:k,x1:"0%",y1:F?"100%":"0%",x2:F?"0%":"100%",y2:"0%"}].concat(O))),p("rect",{class:"tau-chart__legend__gradient__bar",x:A.barX,y:A.barY,width:A.barWidth,height:A.barHeight,fill:"url(#"+k+")"})].concat(C.map(function(e,t){return p("text",{x:A.textX[t],y:A.textY[t],"text-anchor":A.textAnchor},e)})));L.insertAdjacentHTML("beforeend",E)}})},_drawSizeLegend:function(){var e=this;e._size.forEach(function(t){var r=e._chart.select(function(e){return e.config.size===t})[0];if(r){var n=r.config.guide||{},a=r.getScale("size"),i=a.domain().sort(function(e,t){return e-t});if(!Array.isArray(i)||!i.every(isFinite))return;var o=((n.size||{}).label||{}).text||a.dim,c=i[0],s=i[i.length-1],u=[c];if(s-c){var d=y(s-c),h=Math.round(4-d),g=Math.pow(10,h),m=l.unique(e._chart.getDataSources({excludeFilter:["legend"]})[a.source].data.map(function(e){return e[a.dim]}).filter(function(e){return e>=c&&e<=s})).sort(function(e,t){return e-t}),v=b(m,f,a.funcType);u=l.unique(v.map(function(e){return Math.round(e*g)/g}))}var x=T(u[0],u[u.length-1]),S=function(e){return e.length*_*.618};u.reverse();var w=u.map(a),M=Math.max.apply(null,w),C=u.map(x);e._container.insertAdjacentHTML("beforeend",e._template({name:l.escape(o),top:null,items:'<div class="tau-chart__legend__size-wrapper"></div>'}));var L=e._container.lastElementChild.querySelector(".tau-chart__legend__size-wrapper"),j=L.getBoundingClientRect().width,F=!1;(Math.max.apply(null,C.map(S))>j/4||1===C.length)&&(F=!0);var A=F?function(){for(var e=_,t=w[0]/2,r=w[w.length-1]/2,n=[t],a=1,i=void 0,o=void 0;a<w.length;a++)o=w[a-1]/2,i=w[a]/2,n.push(n[a-1]+Math.max(1.618*_,o+e+i));var c=.618*_/2;return{width:j,height:n[n.length-1]+Math.max(r,_/2),circleX:l.range(w.length).map(function(){return M/2}),circleY:n,textAnchor:"start",textX:l.range(C.length).map(function(){return M+8}),textY:n.map(function(e){return e+c})}}():function(){for(var e=Math.max(S(C[0])/2,w[0]/2),t=Math.max(S(C[C.length-1])/2,w[w.length-1]/2),r=(j-w.reduce(function(e,t,r){return e+(0===r||r===w.length-1?t/2:t)},0)-e-t)/(f-1),n=[e],a=1,i=void 0,o=void 0;a<w.length;a++)o=w[a-1]/2,i=w[a]/2,n.push(n[a-1]+o+r+i);var c=w.map(function(e){return M-e/2});return{width:j,height:M+8+_,circleX:n,circleY:c,textAnchor:"middle",textX:n,textY:l.range(C.length).map(function(){return M+8+_})}}(),O=p.apply(void 0,["svg",{class:"tau-chart__legend__size",width:A.width,height:A.height}].concat(w.map(function(e,t){return p("circle",{class:"tau-chart__legend__size__item__circle "+(r.config.color?"color-definite":"color-default-size"),cx:A.circleX[t],cy:A.circleY[t],r:e/2})}),C.map(function(e,t){return p("text",{class:"tau-chart__legend__size__item__label",x:A.textX[t],y:A.textY[t],"text-anchor":A.textAnchor},e)})));L.insertAdjacentHTML("beforeend",O)}})},_getLegendColorByScales:function(){var e=this;return e._color.reduce(function(t,r){var i=e._chart.select(function(e){return e.config.color===r})[0];if(i){var o=i.config.guide||{},c=i.getScale("color"),s=e._chart.getDataSources({excludeFilter:["legend"]}),u=l.unique(s[c.source].data.map(function(e){return e[c.dim]})),d=e._chart.getSpec().scales[r],h=a(u);if(d.order)u=l.union(l.intersection(d.order,u),u);else if("order"===d.dimType&&h)u=u.sort(function(e,t){return new Date(e)-new Date(t)});else{var f=e._legendOrderState[r];u=u.sort(function(e,t){var r=f[e]-f[t];return r&&r/Math.abs(r)})}var _=((o.color||{}).label||{}).text||c.dim,g=(o.color||{}).tickFormatNullAlias||"No "+_,m=e._getFormat(c.dim),p=u.map(function(t){var a=JSON.stringify(n(t)?null:t),i=c.dim+a;return{scaleId:r,dim:c.dim,color:c(t),disabled:e._currentFilters.hasOwnProperty(i),label:m(t),value:a}});t[r]={legendColorItems:p,title:_,colorScale:c,noVal:g}}return t},{})},_drawColorLegend:function(){var e=this,t=this._getLegendColorByScales();Object.keys(t).forEach(function(r){var a=t[r],i=a.legendColorItems,o=a.title,c=a.colorScale,s=a.noVal;e._container.insertAdjacentHTML("beforeend",e._template({name:l.escape(o),top:e._resetTemplate({classDisabled:i.some(function(e){return e.disabled})?"":"disabled"}),items:i.map(function(t){return e._itemTemplate({scaleId:t.scaleId,dim:l.escape(t.dim),color:t.color,cssClass:c.toClass(t.color),cssColor:t.disabled?"transparent":c.toColor(t.color),borderColor:c.toColor(t.color),classDisabled:t.disabled?"disabled":"",label:l.escape(n(t.label)?s:t.label),value:l.escape(t.value)})}).join("")}))}),e._color.length>0&&(e._updateResetButtonPosition(),e._scrollTimeout=null,e._scrollListener=function(){var t=e._container.querySelector(u);t.style.display="none",e._scrollTimeout&&clearTimeout(e._scrollTimeout),e._scrollTimeout=setTimeout(function(){e._updateResetButtonPosition(),t.style.display="",e._scrollTimeout=null},250)},e._getScrollContainer().addEventListener("scroll",e._scrollListener))},_toggleLegendItem:function(e,t){var n=this,a=this._currentFilters,o=e?Array.prototype.filter.call(e.parentNode.childNodes,function(e){return e.matches(d)}):null,c=function(e){var t=e.getAttribute("data-dim"),r=e.getAttribute("data-value");return{sid:e.getAttribute("data-scale-id"),dim:t,val:r,key:t+r}},l=function(e){return e in a},s=function(e,t){var r=c(e);if(l(r.key)===t)if(t){var o=a[r.key];delete a[r.key],e.classList.remove("disabled"),n._chart.removeFilter(o)}else{e.classList.add("disabled");var s=i(r.dim,r.val);a[r.key]=n._chart.addFilter({tag:"legend",predicate:function(e){return!s(e)}})}},u=function(t){return t===e},h=!!e&&l(c(e).key),f=function(e,t){e.querySelector(".tau-chart__legend__guide").style.backgroundColor=t?"":"transparent"};if("reset"===t)o.forEach(function(e){s(e,!0),f(e,!0)});else if("leave-others"===t)o.forEach(function(e){u(e)&&s(e,h)}),f(e,h);else if("focus-single"===t){var _=!h&&o.every(function(e){return u(e)||l(c(e).key)});o.forEach(function(e){var t=u(e)||_;s(e,t)}),h&&f(e,!0)}var g=o.filter(function(e){return!l(c(e).key)}).map(function(e){return JSON.parse(c(e).val)});r.onSelect({type:t,selectedCategories:g}),this._chart.refresh()},_highlightToggle:function(e,t){if(!e.matches(".disabled")){var r=e.getAttribute("data-dim"),n=e.getAttribute("data-value"),a=t?i(r,n):function(e){return null};this._chart.select(function(e){return!0}).forEach(function(e){e.fire("highlight",a)})}},_getScrollContainer:function(){return this._container.parentNode.parentNode},_updateResetButtonPosition:function(){this._container.querySelector(u).style.top=this._getScrollContainer().scrollTop+"px"},_generateColorMap:function(e,t){var r=t.length;return e.reduce(function(e,n,a){return e[n]=t[a%r],e},{})},_assignStaticBrewersOrEx:function(){var e=this;e._color.forEach(function(t){var r=e._chart.getSpec().scales[t],n=e._chart.getDataSources({excludeFilter:["legend"]}),a=e._chart.getScaleFactory(n).createScaleInfoByName(t).domain();if(!r.brewer||Array.isArray(r.brewer)){var i=r.brewer||l.range(20).map(function(e){return"color20-"+(1+e)});r.brewer=e._generateColorMap(a,i)}e._legendOrderState[t]=a.reduce(function(e,t,r){return e[t]=r,e},{})})}}}o.a.api.plugins.add("legend",C),t.default=C},9:function(e,r){e.exports=t}})});